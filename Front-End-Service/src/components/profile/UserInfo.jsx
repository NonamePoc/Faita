import React from 'react'
import { useSelector, useDispatch } from 'react-redux'
import {
  removeFromFriends,
  acceptFriendRequest,
  declineRequest,
  addToFriends,
  fetchReceivedRequests,
  cancelRequest,
} from '../../redux/asyncThunks/friends'
import { setAvatar } from '../../utils/setAvatar'

function UserInfo({ user }) {
  const { friends, sentRequests, receivedRequests } = useSelector(
    (state) => state.friends
  )
  const dispatch = useDispatch()

  const handleDeleteFriend = () => {
    dispatch(removeFromFriends(user.id)).then(() => {
      window.location.reload()
    })
  }

  const handleAddFriend = () => {
    dispatch(addToFriends(user.id)).then(() => {
      window.location.reload()
    })
  }

  const handleDeclineRequest = () => {
    dispatch(declineRequest(user.id)).then(
      (res) =>
        res.payload.status === 200 &&
        dispatch(fetchReceivedRequests()) &&
        window.location.reload()
    )
  }

  const acceptRequest = () => {
    dispatch(acceptFriendRequest(user.id)).then(
      (res) =>
        res.payload.status === 200 &&
        dispatch(fetchReceivedRequests()) &&
        window.location.reload()
    )
  }

  const handleCancelRequest = () => {
    dispatch(cancelRequest(user.id)).then(
      (res) =>
        res.payload.status === 200 &&
        dispatch(fetchReceivedRequests()) &&
        window.location.reload()
    )
  }

  const checkFriend = () => {
    if (friends.some((friend) => friend.id === user.id)) {
      return 'friend'
    } else if (sentRequests.some((req) => req.id === user.id)) {
      return 'sent'
    } else if (receivedRequests.some((req) => req.id === user.id)) {
      return 'received'
    } else {
      return 'stranger'
    }
  }

  const handleOption = () => {
    switch (checkFriend()) {
      case 'friend':
        return (
          <button onClick={handleDeleteFriend} className='btn addFriendBtn'>
            <svg
              width='24'
              height='24'
              viewBox='0 0 24 24'
              fill='none'
              xmlns='http://www.w3.org/2000/svg'
            >
              <g clipPath='url(#clip0_14_267)'>
                <path
                  d='M21.2325 5.5725C21.1148 5.42063 20.9432 5.31974 20.7533 5.29065C20.5633 5.26156 20.3695 5.30649 20.2117 5.41617C20.0539 5.52585 19.9442 5.69192 19.9053 5.8801C19.8664 6.06828 19.9012 6.26423 20.0025 6.4275C20.8766 7.68343 21.4429 9.12747 21.6555 10.6428C21.868 12.1582 21.721 13.7023 21.2261 15.1502C20.7313 16.5982 19.9026 17.9094 18.8071 18.9777C17.7116 20.046 16.38 20.8415 14.92 21.2998C13.4601 21.758 11.9128 21.8662 10.4033 21.6156C8.89373 21.3651 7.46438 20.7627 6.23082 19.8573C4.99727 18.9518 3.99413 17.7688 3.30257 16.4038C2.61101 15.0388 2.25043 13.5302 2.25 12C2.25945 9.90204 2.94124 7.86237 4.19527 6.18043C5.4493 4.49849 7.20952 3.26288 9.2175 2.655C9.31205 2.62693 9.40015 2.58051 9.47676 2.5184C9.55338 2.45628 9.617 2.37968 9.66401 2.29298C9.71102 2.20627 9.74049 2.11115 9.75074 2.01306C9.76099 1.91496 9.75182 1.81581 9.72375 1.72125C9.69568 1.6267 9.64926 1.5386 9.58715 1.46199C9.52503 1.38538 9.44843 1.32175 9.36173 1.27474C9.27502 1.22773 9.1799 1.19826 9.08181 1.18801C8.98371 1.17776 8.88455 1.18693 8.79 1.215C6.79025 1.81035 4.99547 2.95009 3.60624 4.50684C2.21701 6.0636 1.28809 7.97602 0.923289 10.0304C0.558488 12.0847 0.772185 14.2001 1.5405 16.1399C2.30881 18.0798 3.60146 19.7678 5.27398 21.0152C6.94649 22.2627 8.93297 23.0204 11.0114 23.2038C13.0898 23.3872 15.1783 22.9889 17.0433 22.0535C18.9084 21.1182 20.4766 19.6825 21.5727 17.9071C22.6688 16.1317 23.2495 14.0865 23.25 12C23.2542 9.70105 22.5497 7.45668 21.2325 5.5725Z'
                  fill='white'
                />
                <path
                  d='M14.7825 2.65499C15.9517 3.00977 17.0434 3.58232 18 4.34249C18.0773 4.40356 18.1659 4.4488 18.2607 4.47563C18.3555 4.50245 18.4546 4.51035 18.5525 4.49886C18.6503 4.48737 18.745 4.45671 18.831 4.40865C18.917 4.36059 18.9927 4.29606 19.0537 4.21874C19.1148 4.14143 19.16 4.05284 19.1869 3.95804C19.2137 3.86324 19.2216 3.76409 19.2101 3.66624C19.1986 3.56839 19.168 3.47376 19.1199 3.38776C19.0718 3.30175 19.0073 3.22606 18.93 3.16499C17.8154 2.28237 16.5426 1.62053 15.18 1.21499C14.989 1.1583 14.7834 1.17979 14.6083 1.27473C14.4331 1.36967 14.3029 1.53029 14.2462 1.72124C14.1895 1.9122 14.211 2.11785 14.306 2.29297C14.4009 2.46808 14.5615 2.5983 14.7525 2.65499H14.7825ZM11.4675 2.03249C11.5404 2.09874 11.6241 2.15201 11.715 2.18999C11.8048 2.22967 11.9018 2.25017 12 2.25017C12.0981 2.25017 12.1952 2.22967 12.285 2.18999C12.3758 2.15188 12.4595 2.09862 12.5325 2.03249C12.602 1.96241 12.657 1.8793 12.6943 1.78792C12.7316 1.69654 12.7506 1.5987 12.75 1.49999C12.7472 1.30142 12.6695 1.11122 12.5325 0.967493C12.4459 0.87719 12.3381 0.809985 12.2189 0.771996C12.0997 0.734008 11.9729 0.726444 11.85 0.749993C11.803 0.758309 11.7575 0.77347 11.715 0.794993C11.6671 0.81124 11.6217 0.83395 11.58 0.862493L11.4675 0.952493C11.3992 1.02382 11.3457 1.10793 11.31 1.19999C11.2696 1.29481 11.2492 1.39693 11.25 1.49999C11.2512 1.598 11.2715 1.69483 11.31 1.78499C11.3481 1.87581 11.4013 1.9595 11.4675 2.03249ZM17.0325 6.96749C16.892 6.82781 16.7019 6.7494 16.5037 6.7494C16.3056 6.7494 16.1155 6.82781 15.975 6.96749L12 10.9425L8.03248 6.96749C7.889 6.84462 7.70445 6.78042 7.51569 6.78771C7.32693 6.795 7.14788 6.87325 7.01431 7.00682C6.88074 7.14039 6.80249 7.31945 6.7952 7.5082C6.78791 7.69696 6.85211 7.88152 6.97498 8.02499L10.9425 12L6.96748 15.9675C6.88897 16.0347 6.8252 16.1175 6.78019 16.2105C6.73517 16.3036 6.70987 16.4049 6.70588 16.5082C6.70189 16.6115 6.7193 16.7145 6.757 16.8107C6.79471 16.907 6.8519 16.9944 6.92499 17.0675C6.99808 17.1406 7.08549 17.1978 7.18174 17.2355C7.27798 17.2732 7.38098 17.2906 7.48427 17.2866C7.58756 17.2826 7.68891 17.2573 7.78196 17.2123C7.87501 17.1673 7.95774 17.1035 8.02498 17.025L12 13.0575L15.9675 17.025C16.111 17.1479 16.2955 17.2121 16.4843 17.2048C16.673 17.1975 16.8521 17.1192 16.9857 16.9857C17.1192 16.8521 17.1975 16.673 17.2048 16.4843C17.2121 16.2955 17.1479 16.111 17.025 15.9675L13.0575 12L17.025 8.03249C17.0958 7.96327 17.1522 7.88071 17.1909 7.78958C17.2296 7.69846 17.2499 7.60056 17.2506 7.50156C17.2513 7.40255 17.2324 7.30438 17.1949 7.21272C17.1575 7.12105 17.1023 7.03771 17.0325 6.96749Z'
                  fill='white'
                />
              </g>
              <defs>
                <clipPath id='clip0_14_267'>
                  <rect width='24' height='24' fill='white' />
                </clipPath>
              </defs>
            </svg>
            Remove friend
          </button>
        )
      case 'sent':
        return (
          <button onClick={handleCancelRequest} className='btn addFriendBtn'>
            <svg
              width='24'
              height='24'
              viewBox='0 0 24 24'
              fill='none'
              xmlns='http://www.w3.org/2000/svg'
            >
              <g clipPath='url(#clip0_14_267)'>
                <path
                  d='M21.2325 5.5725C21.1148 5.42063 20.9432 5.31974 20.7533 5.29065C20.5633 5.26156 20.3695 5.30649 20.2117 5.41617C20.0539 5.52585 19.9442 5.69192 19.9053 5.8801C19.8664 6.06828 19.9012 6.26423 20.0025 6.4275C20.8766 7.68343 21.4429 9.12747 21.6555 10.6428C21.868 12.1582 21.721 13.7023 21.2261 15.1502C20.7313 16.5982 19.9026 17.9094 18.8071 18.9777C17.7116 20.046 16.38 20.8415 14.92 21.2998C13.4601 21.758 11.9128 21.8662 10.4033 21.6156C8.89373 21.3651 7.46438 20.7627 6.23082 19.8573C4.99727 18.9518 3.99413 17.7688 3.30257 16.4038C2.61101 15.0388 2.25043 13.5302 2.25 12C2.25945 9.90204 2.94124 7.86237 4.19527 6.18043C5.4493 4.49849 7.20952 3.26288 9.2175 2.655C9.31205 2.62693 9.40015 2.58051 9.47676 2.5184C9.55338 2.45628 9.617 2.37968 9.66401 2.29298C9.71102 2.20627 9.74049 2.11115 9.75074 2.01306C9.76099 1.91496 9.75182 1.81581 9.72375 1.72125C9.69568 1.6267 9.64926 1.5386 9.58715 1.46199C9.52503 1.38538 9.44843 1.32175 9.36173 1.27474C9.27502 1.22773 9.1799 1.19826 9.08181 1.18801C8.98371 1.17776 8.88455 1.18693 8.79 1.215C6.79025 1.81035 4.99547 2.95009 3.60624 4.50684C2.21701 6.0636 1.28809 7.97602 0.923289 10.0304C0.558488 12.0847 0.772185 14.2001 1.5405 16.1399C2.30881 18.0798 3.60146 19.7678 5.27398 21.0152C6.94649 22.2627 8.93297 23.0204 11.0114 23.2038C13.0898 23.3872 15.1783 22.9889 17.0433 22.0535C18.9084 21.1182 20.4766 19.6825 21.5727 17.9071C22.6688 16.1317 23.2495 14.0865 23.25 12C23.2542 9.70105 22.5497 7.45668 21.2325 5.5725Z'
                  fill='white'
                />
                <path
                  d='M14.7825 2.65499C15.9517 3.00977 17.0434 3.58232 18 4.34249C18.0773 4.40356 18.1659 4.4488 18.2607 4.47563C18.3555 4.50245 18.4546 4.51035 18.5525 4.49886C18.6503 4.48737 18.745 4.45671 18.831 4.40865C18.917 4.36059 18.9927 4.29606 19.0537 4.21874C19.1148 4.14143 19.16 4.05284 19.1869 3.95804C19.2137 3.86324 19.2216 3.76409 19.2101 3.66624C19.1986 3.56839 19.168 3.47376 19.1199 3.38776C19.0718 3.30175 19.0073 3.22606 18.93 3.16499C17.8154 2.28237 16.5426 1.62053 15.18 1.21499C14.989 1.1583 14.7834 1.17979 14.6083 1.27473C14.4331 1.36967 14.3029 1.53029 14.2462 1.72124C14.1895 1.9122 14.211 2.11785 14.306 2.29297C14.4009 2.46808 14.5615 2.5983 14.7525 2.65499H14.7825ZM11.4675 2.03249C11.5404 2.09874 11.6241 2.15201 11.715 2.18999C11.8048 2.22967 11.9018 2.25017 12 2.25017C12.0981 2.25017 12.1952 2.22967 12.285 2.18999C12.3758 2.15188 12.4595 2.09862 12.5325 2.03249C12.602 1.96241 12.657 1.8793 12.6943 1.78792C12.7316 1.69654 12.7506 1.5987 12.75 1.49999C12.7472 1.30142 12.6695 1.11122 12.5325 0.967493C12.4459 0.87719 12.3381 0.809985 12.2189 0.771996C12.0997 0.734008 11.9729 0.726444 11.85 0.749993C11.803 0.758309 11.7575 0.77347 11.715 0.794993C11.6671 0.81124 11.6217 0.83395 11.58 0.862493L11.4675 0.952493C11.3992 1.02382 11.3457 1.10793 11.31 1.19999C11.2696 1.29481 11.2492 1.39693 11.25 1.49999C11.2512 1.598 11.2715 1.69483 11.31 1.78499C11.3481 1.87581 11.4013 1.9595 11.4675 2.03249ZM17.0325 6.96749C16.892 6.82781 16.7019 6.7494 16.5037 6.7494C16.3056 6.7494 16.1155 6.82781 15.975 6.96749L12 10.9425L8.03248 6.96749C7.889 6.84462 7.70445 6.78042 7.51569 6.78771C7.32693 6.795 7.14788 6.87325 7.01431 7.00682C6.88074 7.14039 6.80249 7.31945 6.7952 7.5082C6.78791 7.69696 6.85211 7.88152 6.97498 8.02499L10.9425 12L6.96748 15.9675C6.88897 16.0347 6.8252 16.1175 6.78019 16.2105C6.73517 16.3036 6.70987 16.4049 6.70588 16.5082C6.70189 16.6115 6.7193 16.7145 6.757 16.8107C6.79471 16.907 6.8519 16.9944 6.92499 17.0675C6.99808 17.1406 7.08549 17.1978 7.18174 17.2355C7.27798 17.2732 7.38098 17.2906 7.48427 17.2866C7.58756 17.2826 7.68891 17.2573 7.78196 17.2123C7.87501 17.1673 7.95774 17.1035 8.02498 17.025L12 13.0575L15.9675 17.025C16.111 17.1479 16.2955 17.2121 16.4843 17.2048C16.673 17.1975 16.8521 17.1192 16.9857 16.9857C17.1192 16.8521 17.1975 16.673 17.2048 16.4843C17.2121 16.2955 17.1479 16.111 17.025 15.9675L13.0575 12L17.025 8.03249C17.0958 7.96327 17.1522 7.88071 17.1909 7.78958C17.2296 7.69846 17.2499 7.60056 17.2506 7.50156C17.2513 7.40255 17.2324 7.30438 17.1949 7.21272C17.1575 7.12105 17.1023 7.03771 17.0325 6.96749Z'
                  fill='white'
                />
              </g>
              <defs>
                <clipPath id='clip0_14_267'>
                  <rect width='24' height='24' fill='white' />
                </clipPath>
              </defs>
            </svg>
            Cancel request
          </button>
        )
      case 'received':
        return (
          <div className='aside-friend-actions'>
            <svg
              onClick={acceptRequest}
              fill='#25a727'
              width='27px'
              height='27px'
              viewBox='-1.44 -1.44 26.88 26.88'
              xmlns='http://www.w3.org/2000/svg'
              stroke='#25a727'
              strokeWidth='0.576'
            >
              <g id='SVGRepo_bgCarrier' strokeWidth='0'></g>
              <g
                id='SVGRepo_tracerCarrier'
                strokeLinecap='round'
                strokeLinejoin='round'
              ></g>
              <g id='SVGRepo_iconCarrier'>
                <defs>
                  <style> .cls-1 </style>
                </defs>
                <path
                  id='accept'
                  className='cls-1'
                  d='M1008,120a12,12,0,1,1,12-12A12,12,0,0,1,1008,120Zm0-22a10,10,0,1,0,10,10A10,10,0,0,0,1008,98Zm-0.08,14.333a0.819,0.819,0,0,1-.22.391,0.892,0.892,0,0,1-.72.259,0.913,0.913,0,0,1-.94-0.655l-2.82-2.818a0.9,0.9,0,0,1,1.27-1.271l2.18,2.184,4.46-7.907a1,1,0,0,1,1.38-.385,1.051,1.051,0,0,1,.36,1.417Z'
                  transform='translate(-996 -96)'
                ></path>
              </g>
            </svg>
            <svg
              onClick={handleDeclineRequest}
              fill='#EE7055'
              className='friend__cancel'
              width='32px'
              height='32px'
              viewBox='0 0 32 32'
              version='1.1'
              xmlns='http://www.w3.org/2000/svg'
            >
              <g id='SVGRepo_bgCarrier' strokeWidth='0'></g>
              <g
                id='SVGRepo_tracerCarrier'
                strokeLinecap='round'
                strokeLinejoin='round'
              ></g>
              <g id='SVGRepo_iconCarrier'>
                <title>cancel1</title>
                <path d='M16 29c-7.18 0-13-5.82-13-13s5.82-13 13-13 13 5.82 13 13-5.82 13-13 13zM16 6c-5.522 0-10 4.478-10 10s4.478 10 10 10c5.523 0 10-4.478 10-10s-4.477-10-10-10zM20.537 19.535l-1.014 1.014c-0.186 0.186-0.488 0.186-0.675 0l-2.87-2.87-2.87 2.87c-0.187 0.186-0.488 0.186-0.675 0l-1.014-1.014c-0.186-0.186-0.186-0.488 0-0.675l2.871-2.869-2.871-2.87c-0.186-0.187-0.186-0.489 0-0.676l1.014-1.013c0.187-0.187 0.488-0.187 0.675 0l2.87 2.87 2.87-2.87c0.187-0.187 0.489-0.187 0.675 0l1.014 1.013c0.186 0.187 0.186 0.489 0 0.676l-2.871 2.87 2.871 2.869c0.186 0.187 0.186 0.49 0 0.675z'></path>
              </g>
            </svg>
          </div>
        )
      case 'stranger':
        return (
          <button
            onClick={handleAddFriend}
            className='btn btn-green addFriendBtn'
          >
            Add friend
          </button>
        )
      default:
        return null
    }
  }

  return (
    <section className='card profile'>
      <div className='profile__topColor' />
      <img
        className='profile__photo avatar'
        src={setAvatar(user.avatar)}
        alt='avatar'
      />
      <div className='profile__info'>
        <h1 className='profile__name'>{user.userName}</h1>
        <p className='profile__descr'>
          {user.firstName} {user.lastName} {user.patronymic}
        </p>
      </div>
      {handleOption()}
    </section>
  )
}

export default UserInfo
